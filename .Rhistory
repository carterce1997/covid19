m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
sim(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 1, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
sim(m)
View(gf_data)
m <-
gf_data %>%
glmer(log_growth_factor ~ 0 + (1 | state), data = .)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 28, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
sim(m)
m
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = positiveIncrease / lag(positiveIncrease)) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
m
sim(m)
m <-
gf_data %>%
lmer(log_growth_factor ~ 2 + (1 | state), data = .)
m <-
gf_data %>%
lmer(log_growth_factor ~ 1 + (1 | state), data = .)
m
sim(m)
m <-
gf_data %>%
lm(log_growth_factor ~ state, data = .)
m
sim(m)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state, data = .)
m
plot(m)
m <-
gf_data %>%
lmer(log_growth_factor ~ 0 + (1 | state), data = .)
plot(m)
sim(m)
m <-
gf_data %>%
lmer(log_growth_factor ~ 1 + (1 | state), data = .)
plot(m)
sim(m)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state), data = .)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state, data = .)
trace <-
sim(m)
trace
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state, data = .)
trace <-
sim(m)
trace
trace@coef
trace@coef %>%
as.data.frame()
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.))
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state'))
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup()
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange()
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
mutate(name = fct_reorder(name, med)) %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange()
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
mutate(name = fct_reorder(name, med)) %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange() +
coord_flip()
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 14, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state, data = .)
trace <-
sim(m)
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
mutate(name = fct_reorder(name, med)) %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange() +
coord_flip()
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(log_growth_factor = log(positiveIncrease / lag(positiveIncrease))) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lm(log_growth_factor ~ 0 + state, data = .)
trace <-
sim(m)
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
mutate(name = fct_reorder(name, med)) %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange() +
coord_flip()
trace@coef %>%
as.data.frame() %>%
pivot_longer(colnames(.)) %>%
mutate(name = str_remove(name, 'state')) %>%
group_by(name) %>%
summarize(
low = quantile(value, .05),
med = median(value),
high = quantile(value, .95)
) %>%
ungroup() %>%
mutate(name = fct_reorder(name, med)) %>%
ggplot(aes(x = name, ymin = low, y = med, ymax = high)) +
geom_pointrange() +
coord_flip() +
theme_minimal()
runApp('visualizations/app2')
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease)),
days_out = date - Sys.Date()
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, date, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ days_out | state, data = .)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease)),
days_out = date - Sys.Date()
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, days_out, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
lmer(log_growth_factor ~ days_out | state, data = .)
m <-
gf_data %>%
lmer(log_growth_factor ~ days_out : state, data = .)
m <-
gf_data %>%
lm(log_growth_factor ~ days_out : state, data = .)
trace <-
sim(m)
summary(m)
m <-
gf_data %>%
lm(log_growth_factor ~ state + days_out : state, data = .)
trace <-
sim(m)
summary(m)
m <-
gf_data %>%
lm(log_growth_factor ~ state * days_out, data = .)
summary(m)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ days_out | state, data = .)
library(rstanarm)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ days_out | state, data = .)
summary(m)
plot(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = .)
plot(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = .)
plot(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 14, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = ., chains = 1)
plot(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = ., chains = 1)
plot(m)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = positiveIncrease / lag(positiveIncrease)
) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = ., chains = 1)
plot(m)
plot(m) +
theme_minimal()
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = positiveIncrease / lag(positiveIncrease)
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
m <-
gf_data %>%
stan_glmer(log_growth_factor ~ 0 + (1 | state), data = ., chains = 1)
plot(m) +
theme_minimal()
rstan:::rstudio_stanc("models/growth_factor_comparison/stan/hierarchical_normal_pooled_location_and_scale.stan")
rstan:::rstudio_stanc("models/growth_factor_comparison/stan/hierarchical_normal_pooled_location_and_scale.stan")
library(rstan)
model <-
stan_model('models/growth_factor_comparison/stan/hierarchical_normal_pooled_location_and_scale.stan')
covid_data <-
get_covid_data()
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = positiveIncrease / lag(positiveIncrease)
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
library(tidybayes)
gf_data %>%
rename(y = log_growth_factor)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 5, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
gf_data %>%
rename(y = log_growth_factor)
stan_data <-
gf_data %>%
rename(y = log_growth_factor) %>%
compose_data()
fit <- sampling(model, data = stan_data, chains = 1)
source('C:/Users/carte/Desktop/covid19/models/growth_factor_comparison/gf_comparison2.R', echo=TRUE)
fit <-
sampling(model, data = stan_data, chains = 1)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 14, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
stan_data <-
gf_data %>%
rename(y = log_growth_factor) %>%
compose_data()
fit <-
sampling(model, data = stan_data, chains = 1)
gf_data <-
covid_data %>%
arrange(date) %>%
group_by(state) %>%
filter(positiveIncrease > 0) %>%
mutate(
log_growth_factor = log(positiveIncrease / lag(positiveIncrease))
) %>%
slice(max(n() - 7, 1):n()) %>%
ungroup() %>%
dplyr::select(state, log_growth_factor) %>%
drop_na(log_growth_factor)
stan_data <-
gf_data %>%
rename(y = log_growth_factor) %>%
compose_data()
fit <-
sampling(model, data = stan_data, chains = 1)
source('C:/Users/carte/Desktop/covid19/models/growth_factor_comparison/gf_comparison2.R', echo=TRUE)
trace <-
gather_draws(fit, mu[state], sigma[state])
trace
trace <-
recover_types(gf_data) %>%
gather_draws(fit, mu[state], sigma[state])
trace
trace <-
gather_draws(fit, mu[state], sigma[state]) %>%
recover_types(gf_data)
trace
