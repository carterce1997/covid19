!(Date == max(Date) & n == 0)
)
stan_data <-
clean_covid_data %>%
compose_data()
fit <-
sampling(hierarchical_cumulative_model, data = stan_data, chains = 1, iter = 2000)
trace <-
fit %>%
recover_types(clean_covid_data) %>%
spread_draws(A[Region], m[Region], s[Region], phi)
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, m)) %>%
ggplot(aes(x = m, y = Region)) +
stat_pointintervalh() +
geom_vline(xintercept = 0) +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
geom_vline(xintercept = 0) +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
scale_x_log10() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, s)) %>%
ggplot(aes(x = s, y = Region)) +
stat_pointintervalh() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A / s)) %>%
ggplot(aes(x = A / s, y = Region)) +
stat_pointintervalh() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, 2 / s)) %>%
ggplot(aes(x = 1 / s, y = Region)) +
stat_pointintervalh() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, 1 / s)) %>%
ggplot(aes(x = 1 / s, y = Region)) +
stat_pointintervalh() +
theme_minimal()
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, 1 / s)) %>%
ggplot(aes(x = 1 / s, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Curve Flatness')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, s)) %>%
ggplot(aes(x = s, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Curve Flatness')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
ggtitle('Estimated Total Cases')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
ggtitle('Estimated Total Cases Over Whole Couse of Outbreak')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over Whole Couse of Outbreak')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over\nWhole Couse of Outbreak')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, m)) %>%
ggplot(aes(x = m, y = Region)) +
stat_pointintervalh() +
geom_vline(xintercept = 0) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Days Until Inflection')
trace %>%
ungroup() %>%
mutate(PercentRunthrough = 1 / (1 + exp(m / s))) %>%
mutate(Region = fct_reorder(Region, PercentRunthrough)) %>%
ggplot(aes(x = PercentRunthrough, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Percent Runthrough')
trace %>%
ungroup() %>%
mutate(PercentRunthrough = 1 / (1 + exp(m / s))) %>%
mutate(Region = fct_reorder(Region, PercentRunthrough)) %>%
ggplot(aes(x = PercentRunthrough, y = Region)) +
stat_pointintervalh() +
xlim(0, 1) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Percent Runthrough')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over\nWhole Couse of Outbreak')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, s)) %>%
ggplot(aes(x = s, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Curve Flatness')
trace %>%
ungroup() %>%
mutate(PercentRunthrough = 1 / (1 + exp(m / s))) %>%
mutate(Region = fct_reorder(Region, PercentRunthrough)) %>%
ggplot(aes(x = PercentRunthrough, y = Region)) +
stat_pointintervalh() +
xlim(0, 1) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Percent Runthrough')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, s)) %>%
ggplot(aes(x = s, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Curve Flatness')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over\nWhole Couse of Outbreak')
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
scale_x_log10() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over\nWhole Couse of Outbreak')
total_cases <-
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, A)) %>%
ggplot(aes(x = A, y = Region)) +
stat_pointintervalh() +
scale_x_log10() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Total Cases Over\nWhole Couse of Outbreak')
flatness <-
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, s)) %>%
ggplot(aes(x = s, y = Region)) +
stat_pointintervalh() +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Curve Flatness')
inflection <-
trace %>%
ungroup() %>%
mutate(Region = fct_reorder(Region, m)) %>%
ggplot(aes(x = m, y = Region)) +
stat_pointintervalh() +
geom_vline(xintercept = 0) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Estimated Days Until Inflection')
runthrough <-
trace %>%
ungroup() %>%
mutate(PercentRunthrough = 1 / (1 + exp(m / s))) %>%
mutate(Region = fct_reorder(Region, PercentRunthrough)) %>%
ggplot(aes(x = PercentRunthrough, y = Region)) +
stat_pointintervalh() +
xlim(0, 1) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Percent Runthrough')
inflection + runthrough + total_cases + flatness
inflection + runthrough + total_cases + flatness + plot_layout(nrow = 1)
runthrough <-
trace %>%
ungroup() %>%
mutate(PercentRunthrough = 1 / (1 + exp(m / s))) %>%
mutate(Region = fct_reorder(Region, -PercentRunthrough)) %>%
ggplot(aes(x = PercentRunthrough, y = Region)) +
stat_pointintervalh() +
xlim(0, 1) +
theme_minimal() +
theme(aspect.ratio = 2) +
ggtitle('Percent Runthrough')
inflection + runthrough + total_cases + flatness + plot_layout(nrow = 1)
inflection + total_cases + flatness + plot_layout(nrow = 1)
source('C:/Users/carte/Desktop/covid19/hierarchical_cumulative_cases_model.R', echo=TRUE)
get_covid_data <- function() {
content_url <-
'http://en.wikipedia.org/wiki/Template:2019-20_coronavirus_pandemic_data/United_States_medical_cases'
content <-
read_html(content_url)
counts_raw <-
content %>%
html_nodes('table') %>%
.[1] %>%
html_table(fill = TRUE, header = FALSE) %>%
as.data.frame()
colnames(counts_raw) <-
counts_raw[2,]
counts_raw <-
counts_raw[-1:-2,-ncol(counts_raw):-(ncol(counts_raw) - 6)]
counts <-
counts_raw %>%
filter(nchar(Date) <= 10) %>%
mutate(
Date = mdy(paste(Date, ', 2020'))
) %>%
drop_na(Date) %>%
pivot_longer(AK:PR, names_to = 'Region', values_to = 'n') %>%
mutate(
n = as.numeric(n),
n = replace_na(n, 0)
)
return(counts)
}
covid_data <-
get_covid_data()
covid_data %>%
arrange(Date) %>%
group_by(Region) %>%
mutate(cumu_n = cumsum(n)) %>%
ungroup() %>%
ggplot() +
geom_path(aes(x = cumu_n, y = n, group = Region)) +
scale_x_log10() +
scale_y_log10() +
facet_wrap(~ Region) +
theme_minimal()
library(tidybayes)
library(rvest)
library(tidyverse)
library(lubridate)
phase_space_model <-
stan_model('stan/phase_space_model.stan')
get_covid_data <- function() {
content_url <-
'http://en.wikipedia.org/wiki/Template:2019-20_coronavirus_pandemic_data/United_States_medical_cases'
content <-
read_html(content_url)
counts_raw <-
content %>%
html_nodes('table') %>%
.[1] %>%
html_table(fill = TRUE, header = FALSE) %>%
as.data.frame()
colnames(counts_raw) <-
counts_raw[2,]
counts_raw <-
counts_raw[-1:-2,-ncol(counts_raw):-(ncol(counts_raw) - 6)]
counts <-
counts_raw %>%
filter(nchar(Date) <= 10) %>%
mutate(
Date = mdy(paste(Date, ', 2020'))
) %>%
drop_na(Date) %>%
pivot_longer(AK:PR, names_to = 'Region', values_to = 'n') %>%
mutate(
n = as.numeric(n),
n = replace_na(n, 0)
)
return(counts)
}
covid_data <-
get_covid_data()
covid_data %>%
arrange(Date) %>%
group_by(Region) %>%
mutate(cumu_n = cumsum(n)) %>%
ungroup() %>%
ggplot() +
geom_path(aes(x = cumu_n, y = n, group = Region)) +
scale_x_log10() +
scale_y_log10() +
facet_wrap(~ Region) +
theme_minimal()
rstan:::rstudio_stanc("stan/phase_space_model.stan")
rstan:::rstudio_stanc("stan/phase_space_model.stan")
rstan:::rstudio_stanc("stan/phase_space_model.stan")
rstan:::rstudio_stanc("stan/phase_space_model.stan")
source('C:/Users/carte/Desktop/covid19/phase_space_model.R', echo=TRUE)
trace$inv_A
source('C:/Users/carte/Desktop/covid19/phase_space_model.R', echo=TRUE)
shiny::runApp('app')
runApp('app')
runApp('app')
runApp('app')
runApp('app')
runApp('app')
runApp('app')
runApp('app')
runApp('app')
shiny::runApp('app')
library(shiny)
library(tidyverse)
library(lubridate)
library(rvest)
content_url <-
'http://en.wikipedia.org/wiki/Template:2019%E2%80%9320_coronavirus_pandemic_data/United_States_medical_cases'
content <-
read_html(content_url)
counts_raw <-
content %>%
html_nodes('table') %>%
.[2] %>%
html_table(fill = TRUE, header = FALSE) %>%
as.data.frame()
colnames(counts_raw) <-
counts_raw[2,]
counts_raw <-
counts_raw[-1:-2,-ncol(counts_raw):-(ncol(counts_raw) - 6)]
counts <-
counts_raw %>%
filter(nchar(Date) <= 10) %>%
mutate(
Date = mdy(paste(Date, ', 2020'))
) %>%
drop_na(Date) %>%
pivot_longer(AK:PA, names_to = 'Region', values_to = 'n') %>%
mutate(
n = as.numeric(n),
n = replace_na(n, 0)
)
total_counts <-
counts %>%
group_by(Date) %>%
summarize(n = sum(n)) %>%
ungroup() %>%
mutate(Region = 'USA')
return(rbind(counts, total_counts))
counts <-
counts_raw %>%
filter(nchar(Date) <= 10) %>%
mutate(
Date = mdy(paste(Date, ', 2020'))
) %>%
drop_na(Date) %>%
pivot_longer(AK:RI, names_to = 'Region', values_to = 'n') %>%
mutate(
n = as.numeric(n),
n = replace_na(n, 0)
)
total_counts <-
counts %>%
group_by(Date) %>%
summarize(n = sum(n)) %>%
ungroup() %>%
mutate(Region = 'USA')
return(rbind(counts, total_counts))
rbind(counts, total_counts)
source('C:/Users/carte/Desktop/covid19/phase_space_model.R', echo=TRUE)
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
install.packages('vroom')
runApp('app2')
results <-
vroom::vroom('https://covidtracking.com/api/states.csv')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
covid_data %>%
filter(state == 'NY') %>%
filter(positive > 50, positiveIncrease > 0) %>%
mutate(growth_factor = positiveIncrease / lag(positiveIncrease))
get_covid_data <- function() {
results <-
vroom::vroom('http://covidtracking.com/api/states/daily.csv') %>%
mutate(date = ymd(date)) %>%
replace(is.na(.), 0)
return(results)
}
covid_data <-
get_covid_data()
covid_data %>%
filter(state == 'NY') %>%
filter(positive > 50, positiveIncrease > 0) %>%
mutate(growth_factor = positiveIncrease / lag(positiveIncrease))
covid_data %>%
filter(state == 'NY') %>%
filter(positive > 50, positiveIncrease > 0) %>%
arrange(date) %>%
mutate(growth_factor = positiveIncrease / lag(positiveIncrease))
covid_data %>%
filter(state == 'NY') %>%
filter(positive > 50, positiveIncrease > 0) %>%
arrange(date) %>%
mutate(growth_factor = positiveIncrease / lag(positiveIncrease)) %>%
select(growth_factor)
runApp('app2')
runApp('app2')
runApp('app2')
library(rstanarm)
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
total_counts <-
results %>%
group_by(date) %>%
summarize_all(function(x) if(class(x) == 'numeric') sum(x) else NA) %>%
ungroup() %>%
mutate(state = 'USA')
results <-
vroom::vroom('https://covidtracking.com/api/states/daily.csv') %>%
mutate(date = ymd(date)) %>%
replace(is.na(.), 0)
total_counts <-
results %>%
group_by(date) %>%
summarize_all(function(x) if(class(x) == 'numeric') sum(x) else NA) %>%
ungroup() %>%
mutate(state = 'USA')
total_counts
rbind(results, total_counts)
runApp('app2')
runApp('app2')
runApp('app2')
runApp('app2')
